# Test Realtime Now: Device 358657105966092

## ğŸ“Š Current Status
- **Device ID:** `358657105966092`
- **Current Position:** Lat: 9.067384, Lon: 7.431522
- **Last Update:** 18 hours ago (not actively updating right now)
- **Status:** Device exists, ready for testing

---

## ğŸ§ª Test Plan

Since the device hasn't updated in 18 hours, we'll test realtime by **manually triggering an update**.

---

## Step 1: Open Vehicle Profile Page

Navigate to:
```
http://localhost:5173/owner/vehicle/358657105966092
```

---

## Step 2: Open Browser Console

Press **F12** â†’ Go to **Console** tab

**Look for these messages:**
```
[Realtime] ğŸ”µ Setting up subscription for device: 358657105966092
[Realtime] ğŸ“¡ Subscription status for 358657105966092: SUBSCRIBED
[Realtime] âœ… Successfully subscribed to vehicle_positions updates for 358657105966092
[Realtime] ğŸ¯ Waiting for position updates...
```

**âœ… If you see these:** Subscription is working!

---

## Step 3: Check WebSocket Connection

1. Go to **Network** tab (still in DevTools)
2. Filter by **"WS"** (WebSocket)
3. Should see WebSocket connection to Supabase Realtime
4. Status should be **"101 Switching Protocols"**

**âœ… If you see WebSocket:** Connection is active!

---

## Step 4: Trigger Manual Update

**Run this SQL in Supabase SQL Editor:**

```sql
-- Trigger a realtime update by moving the marker slightly
UPDATE vehicle_positions 
SET 
  latitude = latitude + 0.0001,
  longitude = longitude + 0.0001,
  cached_at = NOW()
WHERE device_id = '358657105966092';
```

**Expected New Position:**
- Lat: `9.067484` (was 9.067384)
- Lon: `7.431622` (was 7.431522)

---

## Step 5: Watch Console for Update

**Immediately after running SQL, watch console for:**

```
[Realtime] Position update received for 358657105966092: {
  event: 'UPDATE',
  new: { device_id: '358657105966092', latitude: 9.067484, ... },
  ...
}
[Realtime] Mapped data: {
  deviceId: '358657105966092',
  latitude: 9.067484,
  longitude: 7.431622,
  ...
}
[Realtime] âœ… Cache updated and invalidated for 358657105966092
```

**âœ… If you see these:** Realtime is working!

---

## Step 6: Verify Map Updates

**Check the map on the page:**

- âœ… Map marker should move slightly (northeast direction)
- âœ… Coordinates display should update
- âœ… "Last updated" timestamp should refresh
- âœ… **No page refresh needed** - update happens instantly (< 1 second)

**âœ… If map updates instantly:** SUCCESS! Realtime is working!

---

## Step 7: Test Multiple Updates

**Run this SQL multiple times (each time moves marker further):**

```sql
UPDATE vehicle_positions 
SET 
  latitude = latitude + 0.0001,
  longitude = longitude + 0.0001,
  cached_at = NOW()
WHERE device_id = '358657105966092';
```

**Expected:** Each SQL execution â†’ Instant map update (< 1 second)

---

## âœ… Success Checklist

- [ ] Console shows "Successfully subscribed"
- [ ] WebSocket connection active
- [ ] Console shows "Position update received" when SQL runs
- [ ] Map marker moves instantly (< 1 second)
- [ ] No page refresh needed
- [ ] Multiple updates work (test Step 7)

---

## ğŸ¯ Expected Timeline

```
Time 0:00 - Run SQL UPDATE
Time 0:00 - Database updates
Time 0:00 - Realtime pushes to browser
Time 0:01 - Console shows "Position update received"
Time 0:01 - Map marker moves
```

**Total:** < 1 second from SQL execution to map update

---

## ğŸ› Troubleshooting

### Issue: No console messages after SQL update
**Check:**
- Is subscription status "SUBSCRIBED"?
- Is WebSocket connection active?
- Check console for any error messages

### Issue: Console shows update but map doesn't move
**Check:**
- React DevTools â†’ Check if component re-renders
- Verify no JavaScript errors
- Check if map component is receiving updated data

### Issue: Update takes > 1 second
**Check:**
- Network tab â†’ Check WebSocket latency
- Console â†’ Check for any delays in logs
- Verify database update actually completed

---

## ğŸ“ Test Results Template

```
Device: 358657105966092
Test Date: ___________

Subscription:
[ ] Console shows "Successfully subscribed"
[ ] WebSocket connected

Manual Update Test:
[ ] SQL executed successfully
[ ] Console shows "Position update received"
[ ] Map marker moved instantly
[ ] Update latency: _____ seconds (should be < 1)

Multiple Updates:
[ ] Tested 3+ updates
[ ] All updated instantly

Status: âœ… PASS / âŒ FAIL
```

---

## ğŸš€ Quick Test Sequence

1. **Open:** `http://localhost:5173/owner/vehicle/358657105966092`
2. **Check Console:** Look for subscription success
3. **Run SQL:** Update query above
4. **Watch Console:** Should see update message immediately
5. **Check Map:** Marker should move instantly

**If all steps pass:** âœ… **REALTIME IS WORKING!**

---

**Ready to test! Follow the steps above and verify the map updates instantly.** ğŸ¯
